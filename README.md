# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта
Интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 


## Данные и типы данных, используемые в приложении

Карточка товара

```typescript
interface ICard { 
  _id: string;            // уникальный индентификатор товара
  description: string;    // описание товара
  image: string;          // картинка товара
  title: string;          // название товара
  category: string;       // категория товара
  price: number | null;   // цена товара
}
```

Корзина товаров

```typescript
interface IBasket {
  items: ICard[];     // добавленные товары
  total: number;      // сумма заказа
}
```

Данные для оформления заказа

```typescript
interface IOrder {  
  payment: string;    // способ оплаты
  email: string;      // эл.почта
  phone: string;      // номер телефона
  address: string;    // адрес доставки
  total: number;      // сумма заказа
  items: ICard[];     // перечень (id) товаров в заказе
}
```

Данные, отображаемые о товаре на главной странице

```typescript
type TCardPreview = Pick<ICard, 'image' | 'title' | 'category' | 'price'>;
```

Данные, отображаемые при выборе конкретного товара

```typescript
type TCardInfo = Pick<ICard, 'description' | 'image' | 'title' | 'category' | 'price'>;
```

Данные о товаре, находящемся в корзине

```typescript
type TBasketItem = Pick<ICard, 'title' | 'price'>;
```

Данные пользователя, при заполнении формы с ывбором способа оплаты

```typescript
type TPaymentForm = Pick<IOrder, 'payment' | 'address'>;
```

Данные пользователя, при заполнении формы с контактными данными

```typescript
type TContactForm = Pick<IOrder, 'email' | 'phone'>;
```


## Архитектура приложения
В проекте используется архитектурный паттерн `MVP(Model-View-Presenter)`.  
Код приложения разделен на три основных слоя:

1. `Model` (**слой данных**) — представляет бизнес-логику приложения и данные. Отвечает за выполнение операций, таких как чтение и запись данных, обработка бизнес-логики и взаимодействие с базой данных или внешними источниками данных. Модель не зависит от представления или презентера и предоставляет API для доступа к данным. 

2. `View` (**слой представления**) — не содержит бизнес-логики, отображает данные пользователю, предоставленные презентером, и передаёт пользовательский ввод презентеру.

3. `Presenter` (**презентер**) — является посредником между `Model` и `View`, управляет взаимодействием между ними, содержит бизнес-логику приложения. Презентер получает данные от модели, форматирует их и передаёт представлению для отображения. Также обрабатывает пользовательский ввод, передавая соответствующие команды модели для обновления данных.
---

### Базовый код

#### Класс `Api`
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.  
Методы: 
- `get` - выполняет GET-запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST-запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс `EventEmitter`
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие
---


### Слой данных (Model)

#### **Класс `СardsData`**
<u>Назначение:</u>  
Класс отвечает за хранение и логику работы с данными карточек товара.

<u>Поля:</u>
- `cards: ICard[]` - поле для хранения массива карточек продуктов;
- `preview: string | null` - поле для предварительного просмотра определенной карточки (товара) по id;
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

<u>Конструктор:</u>  
Конструктор класса принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.

```typescript
constructor(protected events: EventEmitter)
```

<u>Методы:</u>
- `getCard(cardId: string): ICard` - получение объекта карточки товара по её id;
- `getCardList(): ICard[]` - получение массива объектов с карточками;
- `setCardList(items: ICard[]): void` - cохранение массива объектов с карточками.


#### **Класс `BasketData`**
<u>Назначение:</u>  
Класс отвечает за хранение и логику работы с данными корзины.

<u>Поля:</u>
- `items: ICard[]` - массив объектов продуктов, добавленных в корзину;
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

<u>Конструктор:</u>  
Конструктор класса принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.

```typescript
constructor(protected events: EventEmitter)
```

<u>Методы:</u>
- `addItem(item: ICard): void` - добавляет товар в корзину;
- `removeItem(cardId: string): void` - удаляет товар из корзины по id;
- `isEmpty(): boolean` - проверяет наличие товаров (в целом) в корзине (для управления кнопкой "Оформить");
- `hasItem(cardId: string): boolean` - проверка наличия товара в корзине;
- `getItemCount(): number` - возвращает количество товаров в корзине;
- `get items(): ICard[]` - возвращает массив товаров в корзине;
- `get total(): number` - возвращает общую стоимость всех товаров в корзине;
- `clear(): void` - очищает корзину (например, после оформления заказа).


#### **Класс `OrderData`**
<u>Назначение:</u>  
Класс отвечает за хранение и логику работы с данными заказа.

<u>Поля:</u>
- `payment: string` - cпособ оплаты;
- `email: string` - электронная почта покупателя;
- `phone: string` - номер телефона покупателя;
- `address: string` - адрес доставки покупателя;
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

<u>Конструктор:</u>  
Конструктор класса принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.

```typescript
constructor(protected events: EventEmitter)
```

<u>Методы:</u>
- `setPayment(payment: string): void` - устанавливает способ оплаты и производит валидацию;
- `setEmail(email: string): void` - устанавливает электронную почту и производит валидацию;
- `setPhone(phone: string): void` - устанавливает номер телефона и производит валидацию;
- `setAddress(address: string): void` - устанавливает адрес доставки и производит валидацию;
- `clear(): void` - очистка данных из полей формы заказа;
- `validateOrder(): boolean` - проверка факта и корректности заполнения обязательных полей;
- `getOrderData(): IOrder` - возвращает объект с текущими данными о заказе.

---


### Слой представления (View)

#### **Класс `PageView`**
<u>Назначение:</u>
Отображает главную страницу магазина - список карточек товаров и верхнюю панель (счётчик корзины). Является корневым компонентом UI.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```
container - корневой HTML-элемент, в который рендерится страница.  
events - экземпляр класса EventEmitter для инициации событий.

<u>Поля:</u>
- `catalog: HTMLElement` - контейнер для отображения списка карточек товаров;
- `basketCounter: HTMLElement` - элемент для отображения количества товаров в корзине;
- `events: IEvents` - брокер событий.

<u>Методы:</u>
- `render(data: { catalog: ICard[], basketCount: number }): HTMLElement`  
*Назначение:* рендерит список карточек и обновляет счётчик корзины.  
*Принимает:* объект с данными каталога и количеством товаров в корзине.  
*Возвращает:* корневой элемент страницы.  

Для данных ICard[] будет реализован сеттер `set catalog`, принимающий массив карточек. 


#### **Класс `CardView`**
<u>Назначение:</u>
Абстрактный базовый класс для всех типов карточек товаров. Определяет общую структуру и поведение карточек.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```
container - HTML-элемент карточки.  
events - экземпляр класса EventEmitter для инициации событий.

<u>Поля:</u>
- `container: HTMLElement` - DOM-элемент карточки;
- `events: IEvents` - экземпляр класса EventEmitter для инициации событий;
- `title: HTMLElement` - заголовок товара;
- `image: HTMLImageElement` - изображение товара;
- `price: HTMLElement` - цена товара;
- `category: HTMLElement` - категория товара.

<u>Методы:</u>
- `setTitle(value: string): void` - устанавливает название товара;
- `setImage(src: string, alt: string): void` - устанавливает изображение;
- `setPrice(value: number | null): void` - устанавливает цену;
- `setCategory(value: string): void` - устанавливает категорию;
- `render(data: TCardPreview): HTMLElement` - рендерит карточку по переданным данным.


#### **Класс `CatalogItemView`** (наследуется от CardView)
<u>Назначение:</u>
Отображает карточку товара в списке каталога. При клике генерирует событие выбора товара.

<u>Методы:</u>
- `render(data: TCardPreview): HTMLElement`  
*Назначение:* рендерит карточку товара в каталоге.  
*Принимает:* `TCardPreview` - минимальные данные для отображения.  
*Возвращает:* DOM-элемент карточки.  
*Генерирует событие:* `card:select` при клике на карточку.


#### **Класс `ModalView`**
<u>Назначение:</u>
Класс представляет компонент модального окна, реализует открытие/закрытие и управление содержимым модальных окон. 

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `content: HTMLElement` - внутреннее содержимое модального окна;
- `closeButton: HTMLElement` - крестик закрытия окна;
- `events: IEvents` - экземпляр класса EventEmitter для инициации событий.

<u>Методы:</u>
- `open(): void`  
*Назначение:* открывает модальное окно.  
*Генерирует событие:* `modal:open`.  
- `close(): void`  
*Назначение:* закрывает модальное окно.  
*Генерирует событие:* `modal:close`.
- `render(content: HTMLElement): void` - принимает объект со свойством `content` и вызывает метод `open()`.


#### **Класс `CardModalView`**
<u>Назначение:</u>
Отображает модальное окно с подробной информацией о товаре. Позволяет добавить/удалить товар из корзины и закрыть окно.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `content: HTMLElement` - контейнер с информацией о товаре;
- `button: HTMLButtonElement | null` - кнопка «Купить»/«Убрать из корзины»;
- `closeButton: HTMLElement` - крестик для закрытия модального окна.

<u>Методы:</u>
- `render(data: TCardInfo): HTMLElement`  
*Назначение:* рендерит подробную информацию о товаре.  
*Принимает:* `TCardInfo` - полные данные карточки.  
*Возвращает:* элемент модального окна.  
*Генерирует события:*
  - `card:addBasket` - при нажатии на кнопку «Купить»;
  - `card:removeBasket` - при нажатии на кнопку «Убрать из корзины»;
  - `modal:close` - при клике на крестик или оверлей.
- `setInBasket(inBasket: boolean): void`
*Назначение:* обновляет состояние кнопки в зависимости от того, находится ли товар в корзине.
- `setPrice(price: number | null): void`
*Назначение:* устанавливает отображение цены товара и управляет активностью кнопки.


#### **Класс `BasketView`**
<u>Назначение:</u>
Отображает модальное окно корзины с списком товаров, общей стоимостью и кнопкой «Оформить заказ».

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `list: HTMLElement` - контейнер для списка товаров;
- `total: HTMLElement` - отображение общей стоимости;
- `buttonOrder: HTMLButtonElement` - кнопка перехода к оформлению заказа;
- `items: BasketItemView[]` - массив экземпляров карточек товаров в корзине.

<u>Методы:</u>
- `render(data: IBasket): HTMLElement`  
*Назначение:* рендерит содержимое корзины.  
*Принимает:* объект `IBasket` - список товаров и общая сумма.  
*Возвращает:* DOM-элемент модального окна.  
*Генерирует событие:* `basket:order` при нажатии на кнопку «Оформить».
- `setTotal(value: number): void` - устанавливает общую стоимость.
- `setItems(items: TBasketItem[]): void` - рендерит список товаров (создаёт BasketItemView для каждого).


#### **Класс `BasketItemView`**
<u>Назначение:</u>
Отображает одну карточку товара в корзине (название, цена, кнопка удаления).

<u>Конструктор:</u>

```typescript
constructor(index: number, container: HTMLElement, events: IEvents)
```
index - порядковый номер товара в корзине (для отображения).  
container - DOM-элемент карточки.  
events - брокер событий.

<u>Поля:</u>
- `indexElement: HTMLElement` - отображение номера позиции;
- `title: HTMLElement` - название товара;
- `price: HTMLElement` - цена товара;
- `removeButton: HTMLButtonElement` - кнопка удаления.

<u>Методы:</u>
- `render(data: TBasketItem & { id: string }): HTMLElement`  
*Назначение:* рендерит элемент корзины.  
*Принимает:* объект с title, price, id.  
*Возвращает:* DOM-элемент.  
*Генерирует событие:* `basket:removeItem` при клике на кнопку удаления, передавая id товара.  
- `setIndex(value: number): void` - устанавливает порядковый номер.
- `setPrice(value: number): void` - устанавливает цену.


#### **Класс `OrderView`**
<u>Назначение:</u>
Отображает модальное окно формы заказа, разделённое на два шага:
1. Выбор способа оплаты и ввод адреса доставки.
2. Ввод контактных данных (email, телефон).

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `paymentForm: HTMLElement` - форма оплаты и адреса;
- `contactForm: HTMLElement` - форма контактов;
- `addressInput: HTMLInputElement` - поле ввода адреса;
- `emailInput: HTMLInputElement` - поле email;
- `phoneInput: HTMLInputElement` - поле телефона;
- `buttonOnline: HTMLButtonElement` - выбор оплаты онлайн;
- `buttonCash: HTMLButtonElement` - выбор оплаты при получении;
- `submitButton: HTMLButtonElement` - кнопка отправки формы;

<u>Методы:</u>  
- `render(): HTMLElement`  
*Назначение:* рендерит пустую форму заказа.  
*Возвращает:* DOM-элемент модального окна.
- `setPayment(value: string): void` - выделяет выбранный способ оплаты;
- `setAddress(value: string): void` - устанавливает значение поля адреса;
- `setEmail(value: string): void` - устанавливает email;
- `setPhone(value: string): void` - устанавливает телефон;
- `validateFields(step: 'payment' | 'contacts'): boolean` - проверяет заполнение полей текущего шага;
- `switchToContacts(): void` - переключается на форму контактов;
- `blockSubmit(): void` - блокирует кнопку отправки;
- `unblockSubmit(): void` - разблокирует кнопку отправки.  
*Генерируемые события:*   
  - `form:change` - при изменении любого поля формы;  
  - `order:submit` - при отправке формы (нажатии «Оплатить»).


#### **Класс `SuccessView`**
<u>Назначение:</u>
Отображает модальное окно успешного оформления заказа с итоговой суммой.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, protected events: IEvents)
```

<u>Поля:</u>
- `total: HTMLElement` - отображение итоговой суммы;
- `button: HTMLButtonElement` - кнопка закрытия окна.

<u>Методы:</u>
- `render(total: number): HTMLElement`  
*Назначение:* рендерит окно подтверждения с указанной суммой.  
*Принимает:* число - общая стоимость заказа.  
*Возвращает:* DOM-элемент модального окна.  
*Генерирует событие:* `modal:close` при нажатии на кнопку.

---


### Слой коммуникации
#### **Класс `AppApi`**
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

---


### Взаимодействие компонентов (Presenter)
Код презентера не выделен в отдельный класс, а содержится в основном скрипте `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.  
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

**Список всех событий, которые могут генерироваться в системе:**

*События изменения данных (генерируются классами моделями данных):*
- `cards:changed` - изменение массива карточек товаров;
- `card:preview` - выбор карточки для подробного просмотра (по id);
- `basket:changed` - изменение массива товаров в корзине;
- `order:changed` - изменение данных заказа;
- `order:valid` - корректное заполнение всех обязательных полей формы заказа;
- `order:submit` - отправка данных о заказе;
- `order:success` - успешный ответ от сервера.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление):*
- `modal:open` - открытие модального окна (карточка/корзина/заказ);
- `modal:close` - закрытие модального окна (карточка/корзина/заказ/подтверждение заказа);
- `card:select` - выбор конкретного товара из каталога (открытие карточки товара);
- `card:addBasket` - добавление товара в корзину из модального окна товара (нажатие на кнопку «Купить»);
- `card:removeBasket` - удаление товара из корзины «Убрать из корзины» в модальном окне товара;
- `basket:removeItem` - удаление товара из корзины (нажатие на кнопку мусорной корзины);
- `basket:order` - нажатие на кнопку «Оформить» в корзине;
- `form:change` - изменение значений в полях формы заказа;
- `order:submit` - отправка заполненной формы заказа (нажатие кнопки «Оплатить»).