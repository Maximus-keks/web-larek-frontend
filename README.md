# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта
Интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 


## Данные и типы данных, используемые в приложении

Карточка товара

```typescript
interface ICard { 
  id: string;            // уникальный индентификатор товара
  description: string;    // описание товара
  image: string;          // картинка товара
  title: string;          // название товара
  category: string;       // категория товара
  price: number | null;   // цена товара
}
```

Данные о заказе, отправляемые на сервер

```typescript
interface IOrder {  
  payment: string;    // способ оплаты
  email: string;      // эл.почта
  phone: string;      // номер телефона
  address: string;    // адрес доставки
  total: number;      // сумма заказа
  items: string[];    // перечень (id) товаров в заказе
}
```

Данные, отображаемые о товаре на главной странице

```typescript
type TCardPreview = Pick<ICard, 'image' | 'title' | 'category' | 'price'>;
```

Данные, отображаемые при выборе конкретного товара

```typescript
type TCardInfo = Pick<ICard, 'description' | 'image' | 'title' | 'category' | 'price'>;
```

Данные о товаре, находящемся в корзине

```typescript
type TBasketItem = Pick<ICard, 'title' | 'price'>;
```

Данные пользователя, при заполнении формы с ывбором способа оплаты

```typescript
type TPaymentForm = Pick<IOrder, 'payment' | 'address'>;
```

Данные пользователя, при заполнении формы с контактными данными

```typescript
type TContactForm = Pick<IOrder, 'email' | 'phone'>;
```


## Архитектура приложения
В проекте используется архитектурный паттерн `MVP(Model-View-Presenter)`.  
Код приложения разделен на три основных слоя:

1. `Model` (**слой данных**) — представляет бизнес-логику приложения и данные. Отвечает за выполнение операций, таких как чтение и запись данных, обработка бизнес-логики и взаимодействие с базой данных или внешними источниками данных. Модель не зависит от представления или презентера и предоставляет API для доступа к данным. 

2. `View` (**слой представления**) — не содержит бизнес-логики, отображает данные пользователю, предоставленные презентером, и передаёт пользовательский ввод презентеру.

3. `Presenter` (**презентер**) — является посредником между `Model` и `View`, управляет взаимодействием между ними, содержит бизнес-логику приложения. Презентер получает данные от модели, форматирует их и передаёт представлению для отображения. Также обрабатывает пользовательский ввод, передавая соответствующие команды модели для обновления данных.
---

### Базовый код

#### Класс `Api`
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.  
Методы: 
- `get` - выполняет GET-запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST-запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс `EventEmitter`
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие
---


### Слой данных (Model)

#### **Класс `СardsData`**
<u>Назначение:</u>  
Класс отвечает за хранение и логику работы с данными карточек товара.

<u>Поля:</u>
- `cards: ICard[]` - поле для хранения массива карточек продуктов;
- `preview: string | null` - поле для предварительного просмотра определенной карточки (товара) по id;
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

<u>Конструктор:</u>  
Конструктор класса принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.

```typescript
constructor(protected events: EventEmitter)
```

<u>Методы:</u>
- `getCard(cardId: string): ICard` - получение объекта карточки товара по её id;
- `getCardList(): ICard[]` - получение массива объектов с карточками;
- `setCardList(items: ICard[]): void` - cохранение массива объектов с карточками.


#### **Класс `BasketData`**
<u>Назначение:</u>  
Класс отвечает за хранение и логику работы с данными корзины.

<u>Поля:</u>
- `items: ICard[]` - массив объектов продуктов, добавленных в корзину;
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

<u>Конструктор:</u>  
Конструктор класса принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.

```typescript
constructor(protected events: EventEmitter)
```

<u>Методы:</u>
- `addItem(item: ICard): void` - добавляет товар в корзину;
- `removeItem(cardId: string): void` - удаляет товар из корзины по id;
- `isEmpty(): boolean` - проверяет наличие товаров (в целом) в корзине (для управления кнопкой "Оформить");
- `hasItem(cardId: string): boolean` - проверка наличия товара в корзине;
- `getItemCount(): number` - возвращает количество товаров в корзине;
- `getitems(): ICard[]` - возвращает массив товаров в корзине;
- `gettotal(): number` - возвращает общую стоимость всех товаров в корзине;
- `clear(): void` - очищает корзину (например, после оформления заказа).


#### **Класс `OrderData`**
<u>Назначение:</u>  
Класс отвечает за хранение и логику работы с данными заказа.

<u>Поля:</u>
- `payment: string` - cпособ оплаты;
- `email: string` - электронная почта покупателя;
- `phone: string` - номер телефона покупателя;
- `address: string` - адрес доставки покупателя;
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

<u>Конструктор:</u>  
Конструктор класса принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.

```typescript
constructor(protected events: EventEmitter)
```

<u>Методы:</u>
- `setPayment(payment: string): void` - устанавливает способ оплаты;
- `setEmail(email: string): void` - устанавливает электронную почту и производит валидацию;
- `setPhone(phone: string): void` - устанавливает номер телефона и производит валидацию;
- `setAddress(address: string): void` - устанавливает адрес доставки и производит валидацию;
- `clear(): void` - очистка данных из полей формы заказа;
- `validate(): { payment: string; email: string; phone: string; address: string; } — проверяет правильность заполнения полей заказа, возвращает объект с текстами ошибок для каждого поля: пустая строка означает, что поле заполнено правильно, непустая — содержит описание ошибки. Проверяет, что поля не пустые (с учётом удаления пробелов), а адрес электронной почты соответствует формату.
- `getOrderData(): IOrder` - возвращает объект с текущими данными о заказе.

---


### Слой представления (View)

#### **Класс `PageView`**
<u>Назначение:</u>
Отображает главную страницу магазина - список карточек товаров и верхнюю панель (счётчик корзины).

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```
container - корневой HTML-элемент, в который рендерится страница.  
events - экземпляр класса EventEmitter для инициации событий.

<u>Поля:</u>
- `catalog: HTMLElement` - контейнер для отображения списка карточек товаров;
- `basketCounter: HTMLElement` - элемент для отображения количества товаров в корзине;
- `events: IEvents` - брокер событий.

<u>Методы:</u>
- `render(data: { catalog: ICard[], basketCount: number }): void`  
*Назначение:* рендерит список карточек и обновляет счётчик корзины.  
*Принимает:* объект с данными каталога и количеством товаров в корзине.  
*Возвращает:* корневой элемент страницы.  


#### **Класс `CardView`**
<u>Назначение:</u>
Абстрактный базовый класс для всех типов карточек товаров. Определяет общую структуру и методы отображения карточек.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```
container - HTML-элемент карточки.  
events - экземпляр класса EventEmitter для инициации событий.

<u>Поля:</u>
- `container: HTMLElement` - DOM-элемент карточки;
- `events: IEvents` - экземпляр класса EventEmitter для инициации событий;
- `title: HTMLElement` - заголовок товара;
- `image?: HTMLImageElement` - изображение товара;
- `price: HTMLElement` - цена товара;
- `category?: HTMLElement` - категория товара.

<u>Методы:</u>
- `setTitle(value: string): void` - устанавливает название товара;
- `setImage(src: string, alt: string): void` - устанавливает изображение;
- `setPrice(value: number | null): void` - устанавливает цену;
- `setCategory(value: string): void` - устанавливает категорию;
- `render(data: TCardPreview): void` - рендерит карточку по переданным данным.


#### **Класс `CatalogItemView`**
<u>Назначение:</u>
Наследуется от `CardView`, отображает карточку товара в списке каталога. При клике генерирует событие выбора товара.

<u>Методы:</u>
- `render(data: TCardPreview & { id: string }): void` - переопределяет метод render из CardView, добавляя обработчик клика по карточке, который генерирует событие `card:select` с id товара. 


#### **Класс `BasketItemView`**
<u>Назначение:</u>
Отображает одну карточку товара в корзине (название, цена, кнопка удаления). Наследуется от `CardView`.

<u>Конструктор:</u>

```typescript
constructor(index: number, container: HTMLElement, events: IEvents)
```
index - порядковый номер товара в корзине (для отображения).  
container - DOM-элемент карточки.  
events - брокер событий.

<u>Поля:</u>
- `indexElement: HTMLElement` - отображение номера позиции;
- `removeButton: HTMLButtonElement` - кнопка удаления.

<u>Методы:</u>
- `render(data: TBasketItem & { id: string }): void`  
*Назначение:* рендерит элемент корзины.  
*Принимает:* объект с title, price, id.  
*Генерирует событие:* `basket:removeItem` при клике на кнопку удаления, передавая id товара.  
- `setIndex(value: number): void` - устанавливает порядковый номер.
- `setPrice(value: number): void` - устанавливает цену.


#### **Класс `Modal`**
<u>Назначение:</u>
Базовый класс для модальных окон. Управляет открытием, закрытием и содержимым. 

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `content: HTMLElement` - внутреннее содержимое модального окна;
- `closeButton: HTMLElement` - кнопка закрытия окна (крестик);
- `events: IEvents` - экземпляр класса EventEmitter для инициации событий.

<u>Методы:</u>
- `open(): void`  
*Назначение:* открывает модальное окно.  
*Генерирует событие:* `modal:open`.  
- `close(): void`  
*Назначение:* закрывает модальное окно.  
*Генерирует событие:* `modal:close`.
- `render(content: HTMLElement): void` - устанавливает содержимое модального окна.


#### **Класс `CardModal`**
<u>Назначение:</u>
Отображает подробную информацию о товаре. Позволяет добавить/удалить товар из корзины.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `content: HTMLElement` - контейнер с информацией о товаре;
- `button: HTMLButtonElement | null` - кнопка «Купить»/«Убрать из корзины»;

<u>Методы:</u>
- `render(data: TCardInfo): void`  
*Назначение:* рендерит подробную информацию о товаре.  
*Принимает:* `TCardInfo` - полные данные карточки.  
*Возвращает:* элемент модального окна.  
*Генерирует события:*
  - `card:addBasket` - при нажатии на кнопку «Купить»;
  - `card:removeBasket` - при нажатии на кнопку «Убрать из корзины»;
- `setInBasket(inBasket: boolean): void` - обновляет состояние кнопки в зависимости от того, находится ли товар в корзине.
- `setPrice(price: number | null): void` - устанавливает отображение цены товара и управляет активностью кнопки.


#### **Класс `BasketModal`**
<u>Назначение:</u>
Отображает содержимое корзины: список товаров, общую стоимость и кнопку «Оформить заказ».Наследуется от `Modal`.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `list: HTMLElement` - контейнер для списка товаров;
- `total: HTMLElement` - отображение общей стоимости;
- `buttonOrder: HTMLButtonElement` - кнопка перехода к оформлению заказа;
- `items: BasketItemView[]` - массив экземпляров карточек товаров в корзине.

<u>Методы:</u>
- `render(data: IBasket): void`  
*Назначение:* рендерит содержимое корзины.  
*Принимает:* объект `IBasket` - список товаров и общая сумма.  
*Генерирует событие:* `basket:order` при нажатии на кнопку «Оформить».
- `setTotal(value: number): void` - устанавливает общую стоимость.
- `setItems(items: TBasketItem[]): void` - рендерит список товаров, создавая экземпляры `BasketItemView` для каждого.


#### **Класс `Form`**
<u>Назначение:</u>
Абстрактный базовый класс для форм заказа. Управляет валидацией, ошибками и состоянием кнопки отправки.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `form: HTMLElement` - элемент формы;
- `submitButton: HTMLButtonElement` - кнопка отправки данных формы;
- `errorContainer: HTMLElement` - элемент, в котором отображаются ошибки при невалидности полей.

<u>Методы:</u>  
- `render(data: Partial<TPaymentForm | TContactForm>): void` — принимает данные и обновляет пользовательский интерфейс;
- `set valid(value: boolean)` - устанавливает состояние валидности формы;
- `setErrors(errors: Record<string, string>)`- устанавливает текст ошибок валидации полей формы.
- `lockSubmit(): void` — блокирует кнопку отправки;
- `unlockSubmit(): void` — разблокирует кнопку отправки.


#### **Класс `PaymentForm`**
<u>Назначение:</u>
Отображает форму выбора способа оплаты и ввода адреса доставки. Наследуется от класса `Form`.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `buttonOnline: HTMLButtonElement` - кнопка формы для выбора способа оплаты онлайн;
- `buttonCash: HTMLButtonElement` - кнопка формы для выбора способа оплаты при получении;
- `addressInput: HTMLInputElement` - поле для ввода адреса доставки.

<u>Методы:</u>
- `render(data: TPaymentForm): void` - устанавливает значение поля адреса и активный способ оплаты; 
- `setAddress(value: string): void` - устанавливает адрес доставки;
- `togglePayment(method: 'online' | 'cash'): void` - переключение активного способа оплаты (сброс предыдущего выбора и активиция выбранной кнопки).


#### **Класс `ContactForm`**
<u>Назначение:</u>
Отображает форму ввода контактных данных: электронная почта и телефон пользователя. Наследуется от класса `Form`.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `emailInput: HTMLInputElement` - поле для ввода эл.почты;
- `phoneInput: HTMLInputElement` - поле для ввода номера телефона;

<u>Методы:</u> 
- `render(data: TContactForm): void` - устанавливает значения полей email и телефона;
- `setEmail(value: string): void` - устанавливает email;
- `setPhone(value: string): void` - устанавливает телефон.


#### **Класс `SuccessModal`**
<u>Назначение:</u>
Отображение успешного оформления заказа с итоговой суммой. Наследуется от `Modal`.

<u>Конструктор:</u>

```typescript
constructor(container: HTMLElement, events: IEvents)
```

<u>Поля:</u>
- `total: HTMLElement` - отображение итоговой суммы;
- `button: HTMLButtonElement` - кнопка закрытия окна.

<u>Методы:</u>
- `render(total: number): void` - рендерит окно подтверждения с указанной суммой.  

---


### Слой коммуникации
#### **Класс `AppApi`**
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

<u>Методы:</u>
- `getProducts(): Promise<{ items: ICard[] }>` — получает список всех товаров с сервера;
- `postOrder(order: IOrder): Promise<{ id: string; total: number }> — отправляет заказ на сервер.

---


### Взаимодействие компонентов (Presenter)
Код презентера не выделен в отдельный класс, а содержится в основном скрипте `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.  
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

**Список всех событий, которые могут генерироваться в системе:**

*События изменения данных (генерируются классами моделями данных):*
- `cards:changed` - изменение массива карточек товаров;
- `card:preview` - выбор карточки для подробного просмотра (по id);
- `basket:changed` - изменение массива товаров в корзине;
- `order:changed` - изменение данных заказа;
- `order:valid` - корректное заполнение всех обязательных полей формы заказа;
- `order:submit` - отправка данных о заказе;
- `order:success` - успешный ответ от сервера.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление):*
- `modal:open` - открытие модального окна (карточка/корзина/заказ);
- `modal:close` - закрытие модального окна (карточка/корзина/заказ/подтверждение заказа);
- `card:select` - выбор конкретного товара из каталога (открытие карточки товара);
- `card:addBasket` - добавление товара в корзину из модального окна товара (нажатие на кнопку «Купить»);
- `card:removeBasket` - удаление товара из корзины «Убрать из корзины» в модальном окне товара;
- `basket:removeItem` - удаление товара из корзины (нажатие на кнопку мусорной корзины);
- `basket:order` - нажатие на кнопку «Оформить» в корзине;
- `payment:changed` - изменение формы оплаты заказа;
- `form:change` - изменение значений в полях формы заказа;
- `order:submit` - отправка заполненной формы заказа (нажатие кнопки «Оплатить»).